<!DOCTYPE html>
<html><head>
<title>ESP32 WiFi Setup</title>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
.container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
h1 { text-align: center; color: #333; }
.wifi-list { margin: 20px 0; }
.wifi-item { padding: 10px; margin: 5px 0; background: #f9f9f9; border-radius: 4px; cursor: pointer; border: 1px solid #ddd; }
.wifi-item:hover { background: #e9e9e9; }
.wifi-item.selected { background: #007bff; color: white; }
.form-group { margin: 15px 0; }
label { display: block; margin-bottom: 5px; font-weight: bold; }
input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
button { background: #007bff; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; width: 100%; font-size: 16px; }
button:hover { background: #0056b3; }
button:disabled { background: #6c757d; cursor: not-allowed; }
.status { padding: 10px; margin: 10px 0; border-radius: 4px; display: none; }
.status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
.loading { text-align: center; margin: 20px 0; }
</style>
</head><body>
<div class='container'>
<h1>ESP32 WiFi Setup</h1>
<div class='notice' style='background: #e3f2fd; padding: 15px; margin: 10px 0; border-radius: 4px; border-left: 4px solid #2196F3;'>
<h3>ðŸ“± Setup Instructions:</h3>
<p>1. <strong>Stay connected</strong> to this WiFi network during setup<br>
2. If your phone shows "No Internet" - that's normal, <strong>stay connected</strong><br>
3. Select your home WiFi network below and enter the password<br>
4. The device will restart and connect to your network</p>
</div>
<div id='status' class='status'></div>
<button onclick='scanNetworks()'>Scan for Networks</button>
<div class='loading' id='loading' style='display:none;'>Scanning...</div>
<div class='wifi-list' id='wifiList'></div>
<form id='wifiForm' style='display:none;'>
<div class='form-group'>
<label for='ssid'>Selected Network:</label>
<input type='text' id='ssid' name='ssid' readonly>
</div>
<div class='form-group'>
<label for='password'>Password:</label>
<input type='password' id='password' name='password' placeholder='Enter WiFi Password'>
</div>
<button type='submit'>Connect</button>
</form>
</div>
<script>
let selectedSSID = '';
function showStatus(message, isError) {
  const status = document.getElementById('status');
  status.textContent = message;
  status.className = 'status ' + (isError ? 'error' : 'success');
  status.style.display = 'block';
}
function scanNetworks() {
  document.getElementById('loading').style.display = 'block';
  document.getElementById('wifiList').innerHTML = '';
  fetch('/api/wifi/scan')
    .then(response => response.json())
    .then(data => {
      document.getElementById('loading').style.display = 'none';
      const wifiList = document.getElementById('wifiList');
      if (data.length === 0) {
        wifiList.innerHTML = '<p>No networks found</p>';
        return;
      }
      data.forEach(network => {
        const div = document.createElement('div');
        div.className = 'wifi-item';
        div.textContent = network.ssid + ' (RSSI: ' + network.rssi + ')';
        div.onclick = () => selectNetwork(network.ssid, div);
        wifiList.appendChild(div);
      });
    })
    .catch(error => {
      document.getElementById('loading').style.display = 'none';
      showStatus('Failed to scan networks: ' + error.message, true);
    });
}
function selectNetwork(ssid, element) {
  document.querySelectorAll('.wifi-item').forEach(item => item.classList.remove('selected'));
  element.classList.add('selected');
  selectedSSID = ssid;
  document.getElementById('ssid').value = ssid;
  document.getElementById('wifiForm').style.display = 'block';
}
document.getElementById('wifiForm').addEventListener('submit', function(e) {
  e.preventDefault();
  const ssid = document.getElementById('ssid').value;
  const password = document.getElementById('password').value;
  if (!ssid) {
    showStatus('Please select a network', true);
    return;
  }
  const submitBtn = e.target.querySelector('button');
  submitBtn.disabled = true;
  submitBtn.textContent = 'Connecting...';
  fetch('/api/wifi/connect', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ ssid: ssid, password: password })
  })
  .then(response => response.json())
  .then(data => {
    showStatus(data.message, data.status !== 'success');
    if (data.status === 'success') {
      setTimeout(() => {
        showStatus('Restarting ESP32...', false);
        setTimeout(() => window.location.href = 'http://' + window.location.hostname, 3000);
      }, 2000);
    }
    submitBtn.disabled = false;
    submitBtn.textContent = 'Connect';
  })
  .catch(error => {
    showStatus('Connection failed: ' + error.message, true);
    submitBtn.disabled = false;
    submitBtn.textContent = 'Connect';
  });
});
window.onload = () => scanNetworks();
</script>
</body></html>